function AGAD(){this.ENTER_KEY_CODE=13,this.ESC_KEY_CODE=27,this.PANEL_WIDTH=1072,this.PANEL_TRANSITION_DURATION=500,this.CORRECT_ANSWER_MATERIALIZE_DURATION=200,this.AFTER_CORRECT_DELAY=800,this.INCORRECT_SHAKE_DURATION=300,this.TIPS_AND_TRICKS_TRANSITION_DURATION=166,this.game=new Game,this.panelLinks=$(".panel-links a"),this.tipsAndTricksLink=$(".tips-and-tricks-link"),this.tipsAndTricksWrapper=$(".tips-wrapper"),this.tipsAndTricksMask=this.tipsAndTricksWrapper.find(".opacity-mask"),this.tipsAndTricksTabLinks=this.tipsAndTricksWrapper.find(".material-tab-links a"),this.tipsAndTricksTabs=this.tipsAndTricksWrapper.find(".material-tab"),this.tipsAndTricksCloseIcon=this.tipsAndTricksWrapper.find(".icon-close")}function DataLoader(){this.url="//agad-gplus.appspot.com/partners/question_of_day/3?userId=E913597A-9A1B-11E1-8C0B-12F36188709B"}function Game(){this.questions=[],this.gameInProgress=!1}function Question(t,n,e,i){for(property in t)t.hasOwnProperty(property)&&(this[property]=t[property]);this.hangmanHint=this.hangmanHint.replace(/_/g," _"),this.hostingGame=n,this.maxPoints=e,this.totalTime=i,this.rendered=!1,this.correctlyAnswered=!1,this.pointsEarned=0}AGAD.prototype={_addEventListeners:function(){var t=this;t.panelLinks.on("click",function(n){if(n.preventDefault(),n.stopPropagation(),t.game.gameInProgress){var e=parseInt($(n.target).attr("href").substr(1));t._goToPanel(e),$("body").addClass("show-panels")}}),t.tipsAndTricksLink.on("click",function(n){n.preventDefault(),n.stopPropagation(),t.game.gameInProgress&&t._showTipsAndTricks()}),$(document).on("keydown",function(n){n.keyCode==t.ESC_KEY_CODE&&t._hideTipsAndTricks()}),t.tipsAndTricksMask.on("click",function(){t._hideTipsAndTricks()}),t.tipsAndTricksTabLinks.on("click",function(n){n.preventDefault();var e=$(n.target),i=e.attr("href"),s=$(i);s.length&&(t.tipsAndTricksTabLinks.removeClass("active"),e.addClass("active"),t.tipsAndTricksTabs.removeClass("active"),s.addClass("active"))}),t.tipsAndTricksCloseIcon.on("click",function(){t._hideTipsAndTricks()});var n=$(".panel"),e="Enter your answer...";n.on("focus",".answer-box input",function(t){"readonly"!=$(this).attr("readonly")&&t.target.value==e&&(t.target.value="")}),n.on("blur",".answer-box input",function(t){""==t.target.value&&(t.target.value=e)}),n.on("click",".icon-submit",function(){var n=$(this).closest(".answer-input-wrapper");t._submitAnswer(n)}),n.on("keypress",".answer-box input",function(n){var e=n.keyCode||n.which;if(e==t.ENTER_KEY_CODE||19==e){var i=$(this).closest(".answer-input-wrapper");t._submitAnswer(i),n.preventDefault()}}),n.on("click",".option-hint",function(n){var e=$(this),i=e.find(".hint-prompt"),s=e.find(".hint-value"),r=t._getPanelNum(e),o=r-1,a=t.game.getQuestion(o),c=a.getCategoryColor(),u=JMLib.makeMaterializer(e,c,200,!Modernizr.csstransforms3d),l=DGUtils.getPointerCoords(n),d=e.offset(),f=l[0],h=l[1],g=f-d.left,p=h-d.top;u(g,p,function(){i.hide(),s.show()}),e.addClass("active")}),n.on("click",".option-hangman",function(n){var e=$(this),i=e.find(".hangman-prompt"),s=e.find(".hangman-value"),r=t._getPanelNum(e),o=r-1,a=t.game.getQuestion(o),c=a.getCategoryColor(),u=JMLib.makeMaterializer(e,c,200,!Modernizr.csstransforms3d),l=DGUtils.getPointerCoords(n),d=e.offset(),f=l[0],h=l[1],g=f-d.left,p=h-d.top;u(g,p,function(){i.hide(),s.show()}),e.addClass("active")}),$(".icon-slide").on("click",function(n){n.preventDefault(),n.stopPropagation(),t.game.gameInProgress&&$("body").toggleClass("show-panels")}),$(".agad-top-bar-wrapper").on("click",function(){t.game.gameInProgress&&$("body").toggleClass("show-panels")}),$(".start-button").on("click",function(){$("body").addClass("show-panels"),$("#intro").hide(),$(".frame").show(),$(".panel-link-1").addClass("active"),t.game.startGame()})},_goToPanel:function(t){var n=this;n.panelLinks.removeClass("active"),$(".panel-link-"+t).addClass("active");var e=(t-1)*n.PANEL_WIDTH;$(".panels-container").css("-webkit-transition","-webkit-transform "+n.PANEL_TRANSITION_DURATION+"ms").css("-moz-transition","-moz-transform "+n.PANEL_TRANSITION_DURATION+"ms").css("transition","transform "+n.PANEL_TRANSITION_DURATION+"ms").css("transform","translateX(-"+e+"px)"),n.game.stopAllClocks(),4==t&&n.game.updateSummarySections(),setTimeout(function(){var e=t-1;if(e<n.game.questions.length){var i=n.game.getQuestion(e);i.correctlyAnswered||n.game.getQuestion(e).clock.start()}},n.PANEL_TRANSITION_DURATION)},_submitAnswer:function(t){var n=this,e=t.find("input"),i=t.find(".answer-input-wrapper-2"),s=t.find(".icon-submit"),r=e.val(),o=n._getPanelNum(e),a=o-1,c=n.game.gradeQuestion(a,r);if(c){var u=n.game.getQuestion(a),l=u.clock.getPoints();u.setCorrect(l),u.clock.stop();var d=s.position(),f=s.height(),h=d.left+f/2,g=d.top+f/2,p=u.getCategoryColor(),m=JMLib.makeMaterializer(t,p,n.CORRECT_ANSWER_MATERIALIZE_DURATION,!Modernizr.csstransforms3d);m(h,g,function(){s.fadeOut(n.CORRECT_ANSWER_MATERIALIZE_DURATION),e.attr("readonly",""),t.addClass("correctly-answered"),e.blur();var i=$(".panel-link-"+o);i.addClass("correct")},function(){setTimeout(function(){if(n.game.allQuestionsAnsweredCorrectly())n._goToPanel(4);else{var t=n.game.getQuestion(a),e=n.game.getNextQuestion(t);if(void 0!==e&&-1!==e&&0==e.correctlyAnswered)n._goToPanel(n.game.getIndexOfQuestion(e)+1);else{var i=n.game.getFirstUnansweredQuestionIndex();n._goToPanel(i+1)}}},n.AFTER_CORRECT_DELAY)})}else Modernizr.cssanimations&&Modernizr.csstransforms?(i.css("-webkit-animation","shake "+n.INCORRECT_SHAKE_DURATION+"ms"),i.css("-moz-animation","shake "+n.INCORRECT_SHAKE_DURATION+"ms"),i.css("animation","shake "+n.INCORRECT_SHAKE_DURATION+"ms"),setTimeout(function(){i.css("-webkit-animation",""),i.css("-moz-animation",""),i.css("animation","")},n.INCORRECT_SHAKE_DURATION)):(i.css("color","red"),setTimeout(function(){i.css("color","")},n.INCORRECT_SHAKE_DURATION))},_showTipsAndTricks:function(){var t=this;t.tipsAndTricksWrapper.css("display","block"),setTimeout(function(){t.tipsAndTricksWrapper.addClass("show")},t.TIPS_AND_TRICKS_TRANSITION_DURATION)},_hideTipsAndTricks:function(){var t=this;t.tipsAndTricksWrapper.removeClass("show"),setTimeout(function(){t.tipsAndTricksWrapper.css("display","none")},t.TIPS_AND_TRICKS_TRANSITION_DURATION)},_registerHandlebarsHelpers:function(){Handlebars.registerHelper("get_category_class",function(t){var n=t.replace(" ","-").toLowerCase();return new Handlebars.SafeString(n)})},_getPanelNum:function(t){var n=t.closest(".panel");return parseInt(n.attr("id").substr(-1))},initialize:function(){var t=this;t._registerHandlebarsHelpers(),t.game.initialize(function(){t._addEventListeners()})}},$(function(){var t=new AGAD;t.initialize()});var DGUtils=DGUtils||function(){function t(t,n){var e=$("#"+t).html();if(void 0==e)throw new Error("Can't find template with name: "+t);var i=Handlebars.compile(e),s=i(n);return s}function n(t){var n,e;return t.touches&&t.touches[0]?(n=t.touches[0].pageX,e=t.touches[0].pageY):(n=t.clientX,e=t.clientY),[n,e]}var e={};return e.renderHandlebars=t,e.getPointerCoords=n,e}();DataLoader.prototype={getQuestions:function(t,n){var e=this;$.ajax({url:e.url,dataType:"script"}).done(function(){t(agadData)}).fail(function(t,e,i){n(t.status,e,i)})}},Game.prototype={_renderQuestions:function(){for(var t=this,n=0;n<t.questions.length;n++){var e=t.questions[n];t._renderQuestion(e,n+1),t._setPanelLinkClass(e,n+1)}},_setPanelLinkClass:function(t,n){var e=t.cat.replace(" ","-").toLowerCase();$(".panel-link-"+n).addClass("category-"+e+"-link")},_renderQuestion:function(t,n){var e=this,i=$("#panel"+n+" .panel-content"),s=DGUtils.renderHandlebars("panel-template",t);i.html(s),t.setRendered(!0),t.createClock(),e._renderSummarySection(t,n),t.createSummaryClock()},_renderSummarySection:function(t,n){var e=$("#panel"+n+"-summary"),i=DGUtils.renderHandlebars("summary-template",t);e.html(i)},_getTotalPointsForQuestionIndex:function(t){switch(t){case 0:return 300;case 1:return 600;case 2:return 1200;default:return 300}},_getTotalTimeForQuestionIndex:function(t){var n;switch(t){case 0:n=3;break;case 1:n=8;break;case 2:n=15;break;default:n=3}return 60*n},getQuestion:function(t){var n=this;return t>=0&&t<this.questions.length?n.questions[t]:void console.log("Error: question at index "+t+" does not exist")},gradeQuestion:function(t,n){var e=this,i=e.getQuestion(t);return i.grade(n)},allQuestionsAnsweredCorrectly:function(){var t=this;return void 0==t.getFirstUnansweredQuestionIndex()},updateSummarySections:function(){for(var t=this,n=0,e=0;e<t.questions.length;e++){var i=t.questions[e],s=i.clock.getPoints();i.summaryClock.setPoints(s),i.renderSummaryStatus(),n+=i.pointsEarned}$(".total-points span").html(n)},getIndexOfQuestion:function(t){for(var n=this,e=0;e<n.questions.length;e++){var i=n.questions[e];if(i.equals(t))return e}return void 0},getNextQuestion:function(t){var n=this,e=n.getIndexOfQuestion(t);if(void 0==e)return-1;var i=e+1;return i>n.questions.length-1?void 0:n.getQuestion(i)},getFirstUnansweredQuestionIndex:function(){for(var t=this,n=0;n<t.questions.length;n++){var e=t.questions[n];if(0==e.correctlyAnswered)return n}return void 0},stopAllClocks:function(){for(var t=this,n=0;n<t.questions.length;n++){var e=t.questions[n];e.clock.stop()}},initialize:function(t){var n=this,e=new DataLoader;e.getQuestions(function(e){for(var i=0;i<e.length;i++){var s=e[i],r=n._getTotalPointsForQuestionIndex(i),o=n._getTotalTimeForQuestionIndex(i),a=new Question(s,n,r,o);n.questions.push(a)}n._renderQuestions(),t&&t()},function(t){console.log("Error "+t+". Couldn't load questions from server")})},startGame:function(){var t=this;t.gameInProgress=!0,t.questions[0].clock.start()}};var JMLib=JMLib||{};!function(){function t(t,e,i){function s(){var t=Math.max(0,Math.min(100,l.currentPoints/u.maxPoints)),e=l.canvasWidth,i=l.canvasHeight;o.find(".clock-color").attr("d",n(e,i,150,t,!1,.25)),o.find(".clock-numbers").html(a.getPoints())}var r,o,a=this,c={},u={maxPoints:e,totalTime:i,step:e/(1e3*i)},l={currentPoints:e,canvasWidth:150,canvasHeight:150,running:!1,timeSinceStart:0,isCorrect:!1};this.setPoints=function(t){return l.currentPoints=t,s(),this},this.advance=function(t){if(!l.running)return this;l.timeSinceStart+=t;var n=l.currentPoints-u.step*t;return 0>=n&&(n=0,stop()),this.setPoints(n),this},this.getPoints=function(t){return t?l.currentPoints:Math.ceil(l.currentPoints)},this.start=function(){l.running=!0},this.stop=function(){l.running=!1},this.isRunning=function(){return l.running},this.markCorrect=function(){l.isCorrect=!0,stop()},this.isCorrect=function(){return l.isCorrect},this.isInProgress=function(){return u.maxPoints-l.currentPoints>1},this.showCheck=function(){},this.showX=function(){},this.showCount=function(){},this.getDataURL=function(){o.find(".clock-numbers").css({visibility:"hidden"});var t=o.get(0),n=new XMLSerializer,e=n.serializeToString(t);return o.find(".clock-numbers").css({visibility:"visible"}),('data:image/svg+xml;utf8,<svg class="clock-svg" viewBox="0 0 300 300" version="1.1" xmlns="http://www.w3.org/2000/svg">'+e+"</svg>").replace(/(\r\n|\n|\r|\s|\t)/gm," ")},this.on=function(t,n){void 0===c[t]&&(c[t]=[]),c[t].push(n)},this.setEl=function(t){r=t,o=r.find(".clock-svg")},this.setEl(t),this.getEl=function(){return r},this.setColor=function(t){u.color=t,o.find(".clock-color").css("fill",t),r.find(".clock-numbers").css("fill",t),r.find(".points-text").css("fill",t)};var a=this;setInterval(function(){a.isRunning()&&a.advance(10)},10),a.setColor("transparent"),s()}function n(t,n,e,i,s,r){void 0===s&&(s=!1),void 0===r&&(r=0),i=Math.min(.9999,i);var o=2*i*Math.PI,a=2*r*Math.PI,c=a+o,u=Math.cos(a)*e,l=(-2*!s+1)*Math.sin(a)*e,d=Math.cos(c)*e-u,f=(-2*!s+1)*Math.sin(c)*e-l,h=i>.5?1:0,g=s?1:0;return"M "+t+","+n+" l "+u+", "+l+" a "+e+", "+e+" 1 "+h+","+g+" "+d+","+f+" z"}JMLib.makeClock=function(n,e,i){return new t(n,e,i)}}();var JMLib=JMLib||{};!function(){function t(t,n){return $('<svg height="200" width="200"><circle cx="100" cy="100" r="50"/></svg>').css({transform:"scale3d(0,0,1)",fill:t,position:"absolute",transition:"transform "+n/1e3+"s linear"})}JMLib.makeMaterializer=function(n,e,i,s){if(s)return function(t,s,r,o){"function"==typeof r&&r.call(window,i),n.css({"background-color":e}),setTimeout(function(){"function"==typeof o&&o.call(window,i)},0)};void 0===i&&(i=250);var r=t(e,i),o=!1,a=n.outerHeight(),c=n.outerWidth();return n.append(r),function(t,s,u,l){if(!o){o=!0,r.on("transitionend",function(){n.css({"background-color":e}),setTimeout(function(){r.hide()},30),"function"==typeof l&&l.call(window,i)});var d=Math.max(t-0,c-t),f=Math.max(s-0,a-s),h=Math.sqrt(Math.pow(d,2)+Math.pow(f,2)),g=(2*h+20)/100;"function"==typeof u&&u.call(window,i),setTimeout(function(){r.css({top:s-100+"px",left:t-100+"px",transform:"scale3d("+g+","+g+", 1)",transition:"-webkit-transform "+i/1e3+"s linear",transition:"-moz-transform "+i/1e3+"s linear",transition:"transform "+i/1e3+"s linear"})},0)}}}}(),Question.prototype={_getValidAnswerArray:function(){var t=this,n=[];if(n.push(t.answer.toLowerCase()),""!=t.alternateAnswers)for(var e=t.alternateAnswers.split("|"),i=0;i<e.length;i++){var s=e[i];n.push(s.toLowerCase())}return n},_getContainingPanel:function(){var t=this;if(t.isRendered()){var n=t.hostingGame.getIndexOfQuestion(t),e=$("#panel"+(n+1));return e}console.log("Warning: got panel for question, but the question hasn't been rendered yet")},_getSummarySection:function(){var t=this,n=t.hostingGame.getIndexOfQuestion(t),e=n+1,i=$("#panel"+e+"-summary");return i},getCategoryColor:function(){var t=this;if(t.isRendered()){var n=t._getContainingPanel(),e=n.find(".question-category"),i=e.css("color");return i}console.log("Error: Can't get category color for a question that hasn'tbeen rendered yet")},grade:function(t){var n=this,e=n._getValidAnswerArray();return-1!=e.indexOf(t.toLowerCase())?!0:!1},equals:function(t){var n=this;return n.id==t.id},hasBeenStarted:function(){var t=this;return t.clock.isInProgress()},getStatus:function(){var t=this;return t.correctlyAnswered?t.pointsEarned+" points earned":t.hasBeenStarted()?"In progress":"Not yet started"},renderSummaryStatus:function(){var t=this,n=t._getSummarySection().find(".summary-status");n.html(t.getStatus())},setCorrect:function(t){var n=this;n.correctlyAnswered=!0,n.pointsEarned=t},createClock:function(){var t=this,n=t._getContainingPanel().find(".clock");t.clock=JMLib.makeClock(n,t.maxPoints,t.totalTime),t.clock.setColor(t.getCategoryColor())},createSummaryClock:function(){var t=this,n=t._getSummarySection(),e=n.find(".summary-clock");t.summaryClock=JMLib.makeClock(e,t.maxPoints,t.totalTime),t.summaryClock.setColor(t.getCategoryColor())},setRendered:function(t){var n=this;n.rendered=t},isRendered:function(){var t=this;return t.rendered}};